<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../css/style-global.css">
    <link rel="stylesheet" href="../css/style-galeria-pages.css">
    <link rel="website icon" type="png" href="../img/icon-logo.png">
    <script src="../js/funcoes.js"></script>
    <title>ArtZ | Anatomia</title>
</head>

<body>

    <div class="header">
        <div class="container">
            <div class="header_links">
                <a class="a_link" href="../index.html">Home</a>
                <a class="a_link" href="./index.html">Galeria</a>
            </div>
            <div class="logo">
                <img src="../img/logo-artz-branco.png">
            </div>
            <div class="header_links">
                <a class="a_link" href="../sobre-mim.html">Sobre mim</a>
                <a href="../cadastro.html"><button id="button_cadastro">Faça parte!</button></a>
            </div>
        </div>
    </div>

    <div class="conteudo_body">
        <div class="galeria">
            <div class="banner">
                <div class="container">
                    <p>Galeria</p>
                </div>
            </div>
            <div class="conteudo_galeria">
                <div class="container_conteudo">
                    <p></p>
                </div>
                <div class="comentarios">
                    <h3>Comentarios</h3>
                    <textarea id="input_comentario" style="resize: none; margin-left: 50px; outline: none;"
                        maxlength="20" cols="30" rows="10"></textarea>
                    <button onclick="comentar()">Comentar</button>
                    <div id="div_comentarios"></div>
                </div>
            </div>
        </div>
        <div class="nav_secoes">
            <div class="container_nav">
                <h3>Escolha uma seção</h3>
                <div class="lista">
                    <h4>Desenho</h4>
                    <ul>
                        <li><a href="./anatomia.html">Anatomia</a></li>
                        <li><a href="./paisagem.html">Paisagem</a></li>
                        <li><a href="./personagens.html">Personagens</a></li>
                        <li><a href="./realismo.html">Realismo</a></li>
                        <li><a href="./traco_textura.html">Traço e textura</a></li>
                        <li><a href="./dicas.html">Dicas</a></li>
                    </ul>
                </div>
                <div class="lista">
                    <h4>Pintura</h4>
                    <ul>
                        <li><a href="./materiais.html">Materiais</a></li>
                        <li><a href="./teoria_cores.html">Teoria das cores</a></li>
                        <li><a href="./aquarela.html">Aquarela</a></li>
                        <li><a href="./pintura_oleo.html">Pintura a óleo</a></li>
                        <li><a href="./pintura_giz_lapis.html">Pintura com giz/lápis de cor</a></li>
                        <li><a href="./estilos.html">Estilos famosos</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <div class="container">
            <p id="txt_footer">Copyright © 2023 - 2023 ArtZ. Todos os direitos reservados. | <a href=""> Termos de
                    uso</a> | <a href="">Política de privacidade</a> | <a href="">Referências</a></p>
        </div>
    </div>

</body>

</html>

<script>

    var idSecao = 1;

    carregarComentarios();

    function carregarComentarios() {

        fetch("/usuarios/carregarComentarios", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                idSecaoServer: idSecao,
            })
        })
            .then(function (resposta) {
                if (resposta.ok) {
                    if (resposta.status == 204) {
                        var feed = document.getElementById("div_comentarios");
                        var mensagem = document.createElement("span");
                        mensagem.innerHTML = "Nenhum resultado encontrado."
                        feed.appendChild(mensagem);
                        throw "Nenhum resultado encontrado!!";
                    }

                    resposta.json().then(function (resposta) {
                        console.log("Dados recebidos: ", JSON.stringify(resposta));

                        var feed = document.getElementById("div_comentarios");
                        feed.innerHTML = "";
                        for (let i = 0; i < resposta.length; i++) {
                            var publicacao = resposta[i];

                            // criando e manipulando elementos do HTML via JavaScript
                            var divPublicacao = document.createElement("div");
                            var usuarioNome = document.createElement("h4");
                            var pComentario = document.createElement("p");

                            usuarioNome.innerHTML = publicacao.nome;
                            pComentario.innerHTML = publicacao.comentario;

                            divPublicacao.className = "publicacao";
                            usuarioNome.className = "publicacao-nome";
                            pComentario.className = "publicacao-titulo";

                            divPublicacao.appendChild(usuarioNome);
                            divPublicacao.appendChild(pComentario);
                            feed.appendChild(divPublicacao);
                        }


                    });
                } else {
                    throw ('Houve um erro na API!');
                }
            }).catch(function (resposta) {
                console.error(resposta);
            });




    }

    function comentar() {

        var email = sessionStorage.EMAIL_USUARIO;
        var nome = sessionStorage.NOME_USUARIO;
        var idUsuario = sessionStorage.ID_USUARIO;

        if (email != null && nome != null) {

            var comentario = input_comentario.value;

            if (comentario == "") {
                alert("Insira um comentário!");
            } else {

                fetch("/usuarios/comentar", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        idSecaoServer: idSecao,
                        idUsuarioServer: idUsuario,
                        comentarioServer: comentario
                    })
                }).then(function (resposta) {

                    console.log("resposta: ", resposta);

                    if (resposta.ok) {

                        alert("Comentário postado com sucesso!");
                        location.reload();

                    } else {
                        throw ("Houve um erro ao comentar!");
                    }
                }).catch(function (resposta) {
                    console.log(`#ERRO: ${resposta}`);
                });

                return false;

            }
        } else {
            window.location = "../login.html";
            alert('Faça login para continuar!');

        }

    }


</script>